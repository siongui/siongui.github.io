<!DOCTYPE html>
<html lang="en">
<head><script data-ad-client="ca-pub-0436733829999264" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><meta charset="utf-8">
  <title>i18n Python Web Application by gettext and Jinja2</title>
  <meta name="keywords" content="Python,i18n,Locale,gettext,Web application,web.py,web,Jinja2,html,List Files in Directory"/>
  <meta name="description" content="i18n (Internationalization) Python web applications by GNU gettext tools and Jinja2. Use PO and MO files generated by gettext in Python web application to render HTML of specific languages by Jinja2 template engine."/>
  <meta name="author" content="Siong-Ui Te"/><meta property="og:title" content="i18n Python Web Application by gettext and Jinja2" />    <meta property="og:image" content="/./extra/Dharma_wheel.svg" /><meta property="og:description" content="i18n (Internationalization) Python web applications by GNU gettext tools and Jinja2. Use PO and MO files generated by gettext in Python web application to render HTML of specific languages by Jinja2 template engine." /><meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="apple-touch-icon" href="/./extra/Dharma_wheel.png" />
  <link rel="manifest" href="/manifest.json" />

  <link rel="stylesheet" type="text/css" href="/./theme/css/style.css">
</head>
<body>

<div>
<nav class="nav">
  <div class="nav-left">
    <a class="nav-item" href="/">Theory and Practice</a>
  </div>

  <label for="menu-toggle" class="nav-toggle">&equiv;</label>
  <input type="checkbox" id="menu-toggle" class="is-hidden"/>

  <div class="nav-right nav-menu">
<a class="nav-item" href="/pages/about.html">About</a>
    <a class="nav-item" href="/archives.html">Archives</a>
    <a class="nav-item" href="/categories.html">Categories</a>
    <a class="nav-item" href="/tags.html">Tags</a>
    <a class="nav-item" href="/authors.html">Authors</a>
    <!--TODO: add links for Links(optional), and RSS -->

    <span class="vertical-divider"></span>

        <a class="nav-item" href="/zh/">中文</a>
        <a class="nav-item" href="/th/">ไทย</a>
  </div>
</nav><gcse:search></gcse:search><main role="main" class="article">
  <article>
    <header>
      <h1>
        <a href="/2016/01/17/i18n-python-web-application-by-gettext-jinja2/"
           rel="bookmark"
           title="Permalink to i18n Python Web Application by gettext and Jinja2">
          i18n Python Web Application by gettext and Jinja2
        </a>
      </h1>
    </header>
<aside><time datetime="2016-01-17T05:36:00+08:00">
    January 17, 2016
  </time></aside>
    <aside><div class="edit-on-github"><a href="https://github.com/siongui/userpages/tree/master/content/articles/2016/01/17/i18n-python-web-application-by-gettext-jinja2%25en.rst">Edit on Github</a></div></aside>
    <hr>

    <div class="main-content"><p>GNU <a class="reference external" href="https://www.gnu.org/software/gettext/">gettext</a> tools are great for creating i18n (web) applications. In this post,
assume that <a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/PO-Files.html">PO</a> and <a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/MO-Files.html">MO</a> files generated by <a class="reference external" href="https://www.gnu.org/software/gettext/">gettext</a> are ready. We will use the
<a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/PO-Files.html">PO</a> and <a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/MO-Files.html">MO</a> files to let <a class="reference external" href="https://www.python.org/">Python</a> (web) applications render HTML of specific
languages by <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a> template engine. If you do not know what <a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/PO-Files.html">PO</a> or <a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/MO-Files.html">MO</a> files
are, or you do not know how to create them by <a class="reference external" href="https://www.gnu.org/software/gettext/">gettext</a> tools, please read my
previous post <a class="footnote-reference" href="#id3" id="id1">[1]</a> and <a class="footnote-reference" href="#id11" id="id2">[9]</a> first.</p>
<div class="section" id="po-and-mo-files">
<h2><a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/PO-Files.html">PO</a> and <a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/MO-Files.html">MO</a> files</h2>
<p>I will show how to use <a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/MO-Files.html">MO</a> and <a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/PO-Files.html">PO</a> files by example. In the example, we support
two <a class="reference external" href="https://en.wikipedia.org/wiki/Locale">locale</a>, <em>zh_TW (Traditional Chinese)</em> and <em>vi_VN (Vietnamese)</em>. The zh_TW
PO file are located at <tt class="docutils literal">locale/zh_TW/LC_MESSAGES/messages.po</tt> and vi_VN PO
file are located at <tt class="docutils literal">locale/vi_VN/LC_MESSAGES/messages.po</tt>.</p>
<p>zh_TW PO file <tt class="docutils literal">locale/zh_TW/LC_MESSAGES/messages.po</tt>:</p>
<figure class="github-file">
            <figcaption>
              <a href="https://github.com/siongui/userpages/blob/master/content/code/python-i18n-gettext/locale/zh_TW/LC_MESSAGES/messages.po">messages.po</a> |
              <a href="https://github.com/siongui/userpages">repository</a> |
              <a href="https://raw.githubusercontent.com/siongui/userpages/master/content/code/python-i18n-gettext/locale/zh_TW/LC_MESSAGES/messages.po">view raw</a>
            </figcaption><div class="code-file">
            <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Chinese translations for PACKAGE package.</span>
<span class="c1"># Copyright (C) 2013 THE PACKAGE&#39;S COPYRIGHT HOLDER</span>
<span class="c1"># This file is distributed under the same license as the PACKAGE package.</span>
<span class="c1"># Automatically generated, 2013.</span>
<span class="c1">#</span>
<span class="nv">msgid</span> <span class="s">&quot;&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
<span class="s">&quot;</span><span class="py">Project-Id-Version:</span><span class="s"> PACKAGE VERSION\n&quot;</span>
<span class="s">&quot;</span><span class="py">Report-Msgid-Bugs-To:</span><span class="s"> \n&quot;</span>
<span class="s">&quot;</span><span class="py">POT-Creation-Date:</span><span class="s"> 2013-06-04 10:20+0800\n&quot;</span>
<span class="s">&quot;</span><span class="py">PO-Revision-Date:</span><span class="s"> 2013-03-10 05:19+0800\n&quot;</span>
<span class="s">&quot;</span><span class="py">Last-Translator:</span><span class="s"> Automatically generated\n&quot;</span>
<span class="s">&quot;</span><span class="py">Language-Team:</span><span class="s"> none\n&quot;</span>
<span class="s">&quot;</span><span class="py">Language:</span><span class="s"> zh_TW\n&quot;</span>
<span class="s">&quot;</span><span class="py">MIME-Version:</span><span class="s"> 1.0\n&quot;</span>
<span class="s">&quot;</span><span class="py">Content-Type:</span><span class="s"> text/plain; charset=UTF-8\n&quot;</span>
<span class="s">&quot;</span><span class="py">Content-Transfer-Encoding:</span><span class="s"> 8bit\n&quot;</span>

<span class="nv">msgid</span> <span class="s">&quot;Home&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;首頁&quot;</span>

<span class="nv">msgid</span> <span class="s">&quot;Canon&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;經典&quot;</span>

<span class="nv">msgid</span> <span class="s">&quot;About&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;關於&quot;</span>

<span class="nv">msgid</span> <span class="s">&quot;Setting&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;設定&quot;</span>

<span class="nv">msgid</span> <span class="s">&quot;Translation&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;翻譯&quot;</span>
</pre></div>
</td></tr></table></div></figure>
<p>vi_VN PO file <tt class="docutils literal">locale/vi_VN/LC_MESSAGES/messages.po</tt>:</p>
<figure class="github-file">
            <figcaption>
              <a href="https://github.com/siongui/userpages/blob/master/content/code/python-i18n-gettext/locale/vi_VN/LC_MESSAGES/messages.po">messages.po</a> |
              <a href="https://github.com/siongui/userpages">repository</a> |
              <a href="https://raw.githubusercontent.com/siongui/userpages/master/content/code/python-i18n-gettext/locale/vi_VN/LC_MESSAGES/messages.po">view raw</a>
            </figcaption><div class="code-file">
            <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Vietnamese translations for PACKAGE package.</span>
<span class="c1"># Copyright (C) 2013 THE PACKAGE&#39;S COPYRIGHT HOLDER</span>
<span class="c1"># This file is distributed under the same license as the PACKAGE package.</span>
<span class="c1"># Automatically generated, 2013.</span>
<span class="c1">#</span>
<span class="nv">msgid</span> <span class="s">&quot;&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
<span class="s">&quot;</span><span class="py">Project-Id-Version:</span><span class="s"> PACKAGE VERSION\n&quot;</span>
<span class="s">&quot;</span><span class="py">Report-Msgid-Bugs-To:</span><span class="s"> \n&quot;</span>
<span class="s">&quot;</span><span class="py">POT-Creation-Date:</span><span class="s"> 2013-06-06 23:05+0800\n&quot;</span>
<span class="s">&quot;</span><span class="py">PO-Revision-Date:</span><span class="s"> 2013-06-06 22:50+0800\n&quot;</span>
<span class="s">&quot;</span><span class="py">Last-Translator:</span><span class="s"> Automatically generated\n&quot;</span>
<span class="s">&quot;</span><span class="py">Language-Team:</span><span class="s"> none\n&quot;</span>
<span class="s">&quot;</span><span class="py">Language:</span><span class="s"> vi\n&quot;</span>
<span class="s">&quot;</span><span class="py">MIME-Version:</span><span class="s"> 1.0\n&quot;</span>
<span class="s">&quot;</span><span class="py">Content-Type:</span><span class="s"> text/plain; charset=UTF-8\n&quot;</span>
<span class="s">&quot;</span><span class="py">Content-Transfer-Encoding:</span><span class="s"> 8bit\n&quot;</span>
<span class="s">&quot;</span><span class="py">Plural-Forms:</span><span class="s"> nplurals=1; plural=0;\n&quot;</span>

<span class="nv">msgid</span> <span class="s">&quot;Home&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;Trang chính&quot;</span>

<span class="nv">msgid</span> <span class="s">&quot;Canon&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;Kinh điển&quot;</span>

<span class="nv">msgid</span> <span class="s">&quot;About&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;Giới thiệu&quot;</span>

<span class="nv">msgid</span> <span class="s">&quot;Setting&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;Thiết lập&quot;</span>

<span class="nv">msgid</span> <span class="s">&quot;Translation&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;Dịch&quot;</span>
</pre></div>
</td></tr></table></div></figure>
<p>Generate corresponding MO files by <a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/msgfmt-Invocation.html">msgfmt</a>. Put MO files together with PO files.
So we have two PO files and two MO files:</p>
<div class="highlight"><pre><span></span>locale/zh_TW/LC_MESSAGES/messages.po
locale/zh_TW/LC_MESSAGES/messages.mo
locale/vi_VN/LC_MESSAGES/messages.po
locale/vi_VN/LC_MESSAGES/messages.mo
</pre></div>
</div>
<div class="section" id="source-code">
<h2>Source Code</h2>
<p>Now we can let <a class="reference external" href="https://www.python.org/">Python</a> (web) application speak local language. The
application-independent code is put in the following module:</p>
<figure class="github-file">
            <figcaption>
              <a href="https://github.com/siongui/userpages/blob/master/content/code/python-i18n-gettext/i18n.py">i18n.py</a> |
              <a href="https://github.com/siongui/userpages">repository</a> |
              <a href="https://raw.githubusercontent.com/siongui/userpages/master/content/code/python-i18n-gettext/i18n.py">view raw</a>
            </figcaption><div class="code-file">
            <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding:utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">References:</span>
<span class="sd">http://docs.python.org/2/library/gettext.html</span>
<span class="sd">http://jinja.pocoo.org/docs/extensions/</span>
<span class="sd">http://webpy.org/cookbook/i18n_support_in_template_file</span>
<span class="sd">http://webpy.org/cookbook/runtime-language-switch</span>
<span class="sd">https://code.google.com/p/webapp-improved/source/browse/webapp2_extras/i18n.py</span>
<span class="sd">http://docs.python.org/2/library/threading.html</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">gettext</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="n">localedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;locale&#39;</span><span class="p">)</span>
<span class="n">domain</span> <span class="o">=</span> <span class="s1">&#39;messages&#39;</span>
<span class="n">threadLocalData</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>
<span class="n">threadLocalData</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="s1">&#39;en_US&#39;</span>

<span class="c1"># find out all supported locales in locale directory</span>
<span class="n">locales</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">localedir</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">dirnames</span><span class="p">:</span>
    <span class="n">locales</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
  <span class="k">break</span>

<span class="n">AllTranslations</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">locale</span> <span class="ow">in</span> <span class="n">locales</span><span class="p">:</span>
  <span class="n">AllTranslations</span><span class="p">[</span><span class="n">locale</span><span class="p">]</span> <span class="o">=</span> <span class="n">gettext</span><span class="o">.</span><span class="n">translation</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">localedir</span><span class="p">,</span> <span class="p">[</span><span class="n">locale</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">gettext</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">AllTranslations</span><span class="p">[</span> <span class="n">threadLocalData</span><span class="o">.</span><span class="n">locale</span> <span class="p">]</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ugettext</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">AllTranslations</span><span class="p">[</span> <span class="n">threadLocalData</span><span class="o">.</span><span class="n">locale</span> <span class="p">]</span><span class="o">.</span><span class="n">ugettext</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ngettext</span><span class="p">(</span><span class="n">singular</span><span class="p">,</span> <span class="n">plural</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">AllTranslations</span><span class="p">[</span> <span class="n">threadLocalData</span><span class="o">.</span><span class="n">locale</span> <span class="p">]</span><span class="o">.</span><span class="n">ngettext</span><span class="p">(</span><span class="n">singular</span><span class="p">,</span> <span class="n">plural</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ungettext</span><span class="p">(</span><span class="n">singular</span><span class="p">,</span> <span class="n">plural</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">AllTranslations</span><span class="p">[</span> <span class="n">threadLocalData</span><span class="o">.</span><span class="n">locale</span> <span class="p">]</span><span class="o">.</span><span class="n">ungettext</span><span class="p">(</span><span class="n">singular</span><span class="p">,</span> <span class="n">plural</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setLocale</span><span class="p">(</span><span class="n">locale</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">locale</span> <span class="ow">in</span> <span class="n">locales</span><span class="p">:</span>
    <span class="n">threadLocalData</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="n">locale</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="c1"># for test purpose</span>
  <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">localedir</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">dirnames</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</td></tr></table></div></figure>
<p>The HTML to be rendered is saved as <tt class="docutils literal">view/demo.html</tt>:</p>
<figure class="github-file">
            <figcaption>
              <a href="https://github.com/siongui/userpages/blob/master/content/code/python-i18n-gettext/view/demo.html">demo.html</a> |
              <a href="https://github.com/siongui/userpages">repository</a> |
              <a href="https://raw.githubusercontent.com/siongui/userpages/master/content/code/python-i18n-gettext/view/demo.html">view raw</a>
            </figcaption><div class="code-file">
            <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>i18n Python webapp with gettext and jinja2<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="kp">_</span><span class="o">(</span><span class="s2">&quot;Home&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="kp">_</span><span class="o">(</span><span class="s2">&quot;Canon&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="kp">_</span><span class="o">(</span><span class="s2">&quot;About&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="kp">_</span><span class="o">(</span><span class="s2">&quot;Setting&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="kp">_</span><span class="o">(</span><span class="s2">&quot;Translation&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div></figure>
<p>Use above module and template file to render HTML with translated texts:</p>
<figure class="github-file">
            <figcaption>
              <a href="https://github.com/siongui/userpages/blob/master/content/code/python-i18n-gettext/jj2.py">jj2.py</a> |
              <a href="https://github.com/siongui/userpages">repository</a> |
              <a href="https://raw.githubusercontent.com/siongui/userpages/master/content/code/python-i18n-gettext/jj2.py">view raw</a>
            </figcaption><div class="code-file">
            <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding:utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">jinja2</span>
<span class="kn">import</span> <span class="nn">i18n</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
    <span class="n">loader</span><span class="o">=</span><span class="n">jinja2</span><span class="o">.</span><span class="n">FileSystemLoader</span><span class="p">(</span>
      <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;view&#39;</span><span class="p">)]),</span>
    <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;jinja2.ext.i18n&#39;</span><span class="p">])</span>

<span class="n">env</span><span class="o">.</span><span class="n">install_gettext_translations</span><span class="p">(</span><span class="n">i18n</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s1">&#39;demo.html&#39;</span><span class="p">)</span>
  <span class="n">i18n</span><span class="o">.</span><span class="n">setLocale</span><span class="p">(</span><span class="s2">&quot;zh_TW&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">())</span>

  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="n">i18n</span><span class="o">.</span><span class="n">setLocale</span><span class="p">(</span><span class="s2">&quot;vi_VN&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">())</span>
</pre></div>
</td></tr></table></div></figure>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The <em>domain</em> in this case is <strong>messages</strong>. If you name your <a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/PO-Files.html">PO</a> and <a class="reference external" href="https://www.gnu.org/software/gettext/manual/html_node/MO-Files.html">MO</a> file
as <strong>hello</strong>, the <em>domain</em> becomes <strong>hello</strong>.</p>
<div class="last"><div class="highlight"><pre><span></span>locale/zh_TW/LC_MESSAGES/hello.po
locale/zh_TW/LC_MESSAGES/hello.mo
locale/vi_VN/LC_MESSAGES/hello.po
locale/vi_VN/LC_MESSAGES/hello.mo
</pre></div>
</div></div>
</div>
<div class="section" id="output-of-demo">
<h2>Output of Demo</h2>
<div class="highlight"><pre><span></span>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;i18n Python webapp with gettext and jinja2&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div&gt;首頁&lt;/div&gt;
  &lt;div&gt;經典&lt;/div&gt;
  &lt;div&gt;關於&lt;/div&gt;
  &lt;div&gt;設定&lt;/div&gt;
  &lt;div&gt;翻譯&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

-----

&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;i18n Python webapp with gettext and jinja2&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div&gt;Trang chính&lt;/div&gt;
  &lt;div&gt;Kinh điển&lt;/div&gt;
  &lt;div&gt;Giới thiệu&lt;/div&gt;
  &lt;div&gt;Thiết lập&lt;/div&gt;
  &lt;div&gt;Dịch&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
<p>Tested on: <tt class="docutils literal">Ubuntu Linux 15.10</tt>, <tt class="docutils literal">Python 2.7.10</tt>, <tt class="docutils literal">jinja2 2.8</tt>.</p>
<hr class="docutils" />
<p>References:</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="/2016/01/07/i18n-web-application-by-gnu-gettext-tools/">Internationalization (i18n) of Web Application by GNU gettext Tools</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><a class="reference external" href="https://docs.python.org/2/library/gettext.html">22.1. gettext — Multilingual internationalization services — Python 2.7.11 documentation</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td><a class="reference external" href="http://jinja.pocoo.org/docs/extensions/#i18n-extension">Extensions — Jinja2 Documentation</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><a class="reference external" href="http://webpy.org/cookbook/i18n_support_in_template_file">i18n support in template file (web.py)</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[5]</td><td><a class="reference external" href="http://webpy.org/cookbook/runtime-language-switch">Run-time language switch (web.py)</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[6]</td><td><a class="reference external" href="https://code.google.com/p/webapp-improved/source/browse/webapp2_extras/i18n.py">i18n.py - webapp-improved - Google App Engine's webapp, take two - Google Project Hosting</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[7]</td><td><a class="reference external" href="https://docs.python.org/2/library/threading.html">16.2. threading — Higher-level threading interface — Python 2.7.11 documentation</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td><a class="reference external" href="/2016/01/08/golang-i18n-go-application-by-gnu-gettext/">[Golang] Internationalization (i18n) of Go Application by GNU gettext Tools</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[9]</a></td><td><a class="reference external" href="/2016/01/14/python-i18n-py-application-by-gnu-gettext/">[Python] Internationalization (i18n) of Python Application by GNU gettext Tools</a></td></tr>
</tbody>
</table>
</div>
</div>

    <footer><hr><address><b>Author</b>:
    <a rel="author"
       href="/author/siong-ui-te.html">Siong-Ui Te</a>
  </address><aside>
    <i>&isin;</i> <b>Category</b>:
    <a href="/category/python.html">Python</a>
  </aside><aside>
    <i>&sum;</i> <b>Tags</b>:
      <a href="/tag/python.html">Python</a>
,       <a href="/tag/i18n.html">i18n</a>
,       <a href="/tag/locale.html">Locale</a>
,       <a href="/tag/gettext.html">gettext</a>
,       <a href="/tag/web-application.html">Web application</a>
,       <a href="/tag/webpy.html">web.py</a>
,       <a href="/tag/web.html">web</a>
,       <a href="/tag/jinja2.html">Jinja2</a>
,       <a href="/tag/html.html">html</a>
,       <a href="/tag/list-files-in-directory.html">List Files in Directory</a>
  </aside></footer>
  </article>
</main>
</div>
<div class="layout-footer">Powered by
  <a href="https://pages.github.com/">Github Pages</a>,
  <a href="http://blog.getpelican.com/">Pelican</a>,
  <a href="https://github.com/Kronuz/pyScss">pyScss</a>.
</div>
<script>
  (function() {
    var cx = '000759460633137666077:43yuu4nvb0c';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-31712770-3', 'auto');
  ga('send', 'pageview');

</script><script>
navigator.serviceWorker && navigator.serviceWorker.register('/sw.js').then(function(registration) {
  console.log('Excellent, registered with scope: ', registration.scope);
});
</script></body>
</html>